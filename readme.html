<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Contributing" href="contributing.html" /><link rel="prev" title="Documentation for dolomite-base" href="index.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Save and load Bioconductor objects in Python - dolomite-base 0.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">dolomite-base 0.3.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">dolomite-base 0.3.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributions &amp; Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/modules.html">Module Reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Module Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="api/dolomite_base.html">dolomite_base package</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/readme.md.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <!-- These are examples of badges you might want to add to your README:
     please update the URLs accordingly

[![Built Status](https://api.cirrus-ci.com/github/<USER>/dolomite.svg?branch=main)](https://cirrus-ci.com/github/<USER>/dolomite)
[![ReadTheDocs](https://readthedocs.org/projects/dolomite/badge/?version=latest)](https://dolomite.readthedocs.io/en/stable/)
[![Coveralls](https://img.shields.io/coveralls/github/<USER>/dolomite/main.svg)](https://coveralls.io/r/<USER>/dolomite)
[![Conda-Forge](https://img.shields.io/conda/vn/conda-forge/dolomite.svg)](https://anaconda.org/conda-forge/dolomite)
[![Twitter](https://img.shields.io/twitter/url/http/shields.io.svg?style=social&label=Twitter)](https://twitter.com/dolomite)
-->
<p><a class="reference external" href="https://pyscaffold.org/"><img alt="Project generated with PyScaffold" src="https://img.shields.io/badge/-PyScaffold-005CA0?logo=pyscaffold" /></a>
<a class="reference external" href="https://pypi.org/project/dolomite-base/"><img alt="PyPI-Server" src="https://img.shields.io/pypi/v/dolomite-base.svg" /></a>
<a class="reference external" href="https://pepy.tech/project/dolomite-base"><img alt="Monthly Downloads" src="https://pepy.tech/badge/dolomite-base/month" /></a>
<img alt="Unit tests" src="https://github.com/ArtifactDB/dolomite-base/actions/workflows/run-tests.yml/badge.svg" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="save-and-load-bioconductor-objects-in-python">
<h1>Save and load Bioconductor objects in Python<a class="headerlink" href="#save-and-load-bioconductor-objects-in-python" title="Link to this heading">¶</a></h1>
<p>The <strong>dolomite-base</strong> package is the Python counterpart to the <a class="reference external" href="https://github.com/ArtifactDB/alabaster.base"><strong>alabaster.base</strong></a> R package
for language-agnostic reading and writing of Bioconductor objects (see the <a class="reference external" href="https://github.com/BiocPy"><strong>BiocPy</strong></a> project).
This is a more robust and portable alternative to the typical approach of pickling Python objects to save them to disk.</p>
<ul class="simple">
<li><p>By separating the on-disk representation from the in-memory object structure, we can more easily adapt to changes in class definitions.
This improves robustness to Python environment updates.</p></li>
<li><p>By using standard file formats like HDF5 and CSV, we ensure that the objects can be easily read from other languages like R and Javascript.
This improves interoperability between application ecosystems.</p></li>
<li><p>By breaking up complex Bioconductor objects into their components, we enable modular reads and writes to the backing store.
We can easily read or update part of an object without having to consider the other parts.</p></li>
</ul>
<p>The <strong>dolomite-base</strong> package defines the base generics to read and write the file structures along with the associated metadata.
Implementations of these methods for various Bioconductor classes can be found in the other <strong>dolomite</strong> packages like
<a class="reference external" href="https://github.com/ArtifactDB/dolomite-ranges"><strong>dolomite-ranges</strong></a> and <a class="reference external" href="https://github.com/ArtifactDB/dolomite-se"><strong>dolomite-se</strong></a>.</p>
<section id="quick-start">
<h2>Quick start<a class="headerlink" href="#quick-start" title="Link to this heading">¶</a></h2>
<p>First, we’ll install the <strong>dolomite-base</strong> package.
This package is available from <a class="reference external" href="https://pypi.org/project/dolomite-base">PyPI</a> so we can use the standard installation process:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>dolomite-base
</pre></div>
</div>
<p>The simplest example involves saving a <a class="reference external" href="https://github.com/BiocPy/BiocFrame"><code class="docutils literal notranslate"><span class="pre">BiocFrame</span></code></a> inside a staging directory.
Let’s mock one up:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">biocframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">biocframe</span><span class="o">.</span><span class="n">BiocFrame</span><span class="p">({</span>
    <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span> <span class="p">]</span>
<span class="p">})</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1">## BiocFrame with 10 rows and 2 columns</span>
<span class="c1">##           X      Y</span>
<span class="c1">##     &lt;range&gt; &lt;list&gt;</span>
<span class="c1">## [0]       0      a</span>
<span class="c1">## [1]       1      b</span>
<span class="c1">## [2]       2      c</span>
<span class="c1">## [3]       3      d</span>
<span class="c1">## [4]       4      e</span>
<span class="c1">## [5]       5      f</span>
<span class="c1">## [6]       6      g</span>
<span class="c1">## [7]       7      h</span>
<span class="c1">## [8]       8      i</span>
<span class="c1">## [9]       9      j</span>
</pre></div>
</div>
<p>We save our <code class="docutils literal notranslate"><span class="pre">BiocFrame</span></code> to a user-specified directory with the <code class="docutils literal notranslate"><span class="pre">save_object()</span></code> function.
This function saves its input object to file according to the relevant <a class="reference external" href="https://github.com/ArtifactDB/takane">specification</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">dolomite_base</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;my_df&quot;</span><span class="p">)</span>
<span class="n">dolomite_base</span><span class="o">.</span><span class="n">save_object</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="c1">## [&#39;basic_columns.h5&#39;, &#39;OBJECT&#39;]</span>
</pre></div>
</div>
<p>We load the contents of the directory back into a Python session by using the <code class="docutils literal notranslate"><span class="pre">read_object()</span></code> function.
Note that the exact Python types for the <code class="docutils literal notranslate"><span class="pre">BiocFrame</span></code> columns may not be preserved by the round trip,
though the contents of the columns will be unchanged.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">dolomite_base</span><span class="o">.</span><span class="n">read_object</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="n">BiocFrame</span> <span class="k">with</span> <span class="mi">10</span> <span class="n">rows</span> <span class="ow">and</span> <span class="mi">2</span> <span class="n">columns</span>
<span class="c1">##                    X            Y</span>
<span class="c1">##     &lt;ndarray[int32]&gt; &lt;StringList&gt;</span>
<span class="c1">## [0]                0            a</span>
<span class="c1">## [1]                1            b</span>
<span class="c1">## [2]                2            c</span>
<span class="c1">## [3]                3            d</span>
<span class="c1">## [4]                4            e</span>
<span class="c1">## [5]                5            f</span>
<span class="c1">## [6]                6            g</span>
<span class="c1">## [7]                7            h</span>
<span class="c1">## [8]                8            i</span>
<span class="c1">## [9]                9            j</span>
</pre></div>
</div>
<p>Check out the <a class="reference external" href="https://artifactdb.github.io/dolomite-base/api/modules.html">API reference</a> for more details.</p>
</section>
<section id="supported-classes">
<h2>Supported classes<a class="headerlink" href="#supported-classes" title="Link to this heading">¶</a></h2>
<p>The saving/reading process can be applied to a range of <a class="reference external" href="https://github.com/BiocPy"><strong>BiocPy</strong></a> data structures,
provided the appropriate <strong>dolomite</strong> package is installed.
Each package implements a saving and reading function for its associated classes,
which are automatically used from <strong>dolomite-base</strong>’s <code class="docutils literal notranslate"><span class="pre">save_object()</span></code> and <code class="docutils literal notranslate"><span class="pre">read_object()</span></code> functions, respectively.
(That is, there is no need to explicitly <code class="docutils literal notranslate"><span class="pre">import</span></code> a package when calling <code class="docutils literal notranslate"><span class="pre">save_object()</span></code> or <code class="docutils literal notranslate"><span class="pre">read_object()</span></code> for its classes.)</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Package</p></th>
<th class="head"><p>Object types</p></th>
<th class="head"><p>PyPI</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference external" href="https://github.com/ArtifactDB/dolomite-base"><strong>dolomite-base</strong></a></p></td>
<td><p><a class="reference external" href="https://github.com/BiocPy/BiocFrame"><code class="docutils literal notranslate"><span class="pre">BiocFrame</span></code></a>, <code class="docutils literal notranslate"><span class="pre">list</span></code>, <code class="docutils literal notranslate"><span class="pre">dict</span></code>, <a class="reference external" href="https://github.com/BiocPy/BiocUtils"><code class="docutils literal notranslate"><span class="pre">NamedList</span></code></a></p></td>
<td><p><a class="reference external" href="https://pypi.org/project/dolomite-base/"><img alt="" src="https://img.shields.io/pypi/v/dolomite-base.svg" /></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://github.com/ArtifactDB/dolomite-matrix"><strong>dolomite-matrix</strong></a></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code>, <code class="docutils literal notranslate"><span class="pre">scipy.sparse.spmatrix</span></code>, <a class="reference external" href="https://github.com/BiocPy/DelayedArray"><code class="docutils literal notranslate"><span class="pre">DelayedArray</span></code></a></p></td>
<td><p><a class="reference external" href="https://pypi.org/project/dolomite-matrix/"><img alt="" src="https://img.shields.io/pypi/v/dolomite-matrix.svg" /></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://github.com/ArtifactDB/dolomite-ranges"><strong>dolomite-ranges</strong></a></p></td>
<td><p><a class="reference external" href="https://github.com/BiocPy/GenomicRanges"><code class="docutils literal notranslate"><span class="pre">GenomicRanges</span></code></a>, <code class="docutils literal notranslate"><span class="pre">GenomicRangesList</span></code></p></td>
<td><p><a class="reference external" href="https://pypi.org/project/dolomite-ranges/"><img alt="" src="https://img.shields.io/pypi/v/dolomite-ranges.svg" /></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://github.com/ArtifactDB/dolomite-se"><strong>dolomite-se</strong></a></p></td>
<td><p><a class="reference external" href="https://github.com/BiocPy/SummarizedExperiment"><code class="docutils literal notranslate"><span class="pre">SummarizedExperiment</span></code></a>, <code class="docutils literal notranslate"><span class="pre">RangedSummarizedExperiment</span></code></p></td>
<td><p><a class="reference external" href="https://pypi.org/project/dolomite-se/"><img alt="" src="https://img.shields.io/pypi/v/dolomite-se.svg" /></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference external" href="https://github.com/ArtifactDB/dolomite-sce"><strong>dolomite-sce</strong></a></p></td>
<td><p><a class="reference external" href="https://github.com/BiocPy/SingleCellExperiment"><code class="docutils literal notranslate"><span class="pre">SingleCellExperiment</span></code></a></p></td>
<td><p><a class="reference external" href="https://pypi.org/project/dolomite-sce/"><img alt="" src="https://img.shields.io/pypi/v/dolomite-sce.svg" /></a></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference external" href="https://github.com/ArtifactDB/dolomite-mae"><strong>dolomite-mae</strong></a></p></td>
<td><p><a class="reference external" href="https://bioconductor.org/packages/MultiAssayExperiment"><code class="docutils literal notranslate"><span class="pre">MultiAssayExperiment</span></code></a></p></td>
<td><p><a class="reference external" href="https://pypi.org/project/dolomite-mae/"><img alt="" src="https://img.shields.io/pypi/v/dolomite-mae.svg" /></a></p></td>
</tr>
</tbody>
</table>
</div>
<p>All of the listed packages are available from PyPI and can be installed with the usual <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span></code> procedure.
Alternatively, to install all packages in one go, users can install the <a class="reference external" href="https://pypi.org/project/dolomite"><strong>dolomite</strong></a> umbrella package.</p>
</section>
<section id="operating-on-directories">
<h2>Operating on directories<a class="headerlink" href="#operating-on-directories" title="Link to this heading">¶</a></h2>
<p>Users can move freely rename or relocate directories and the <code class="docutils literal notranslate"><span class="pre">read_object()</span></code> function will still work.
For example, we can easily copy the entire directory to a new file system and everything will still be correctly referenced within the directory.
The simplest way to share objects is to just <code class="docutils literal notranslate"><span class="pre">zip</span></code> or <code class="docutils literal notranslate"><span class="pre">tar</span></code> the staging directory for <em>ad hoc</em> distribution,
though more serious applications will use storage systems like AWS S3 for easier distribution.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mocking up an object:</span>
<span class="kn">import</span> <span class="nn">biocframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">biocframe</span><span class="o">.</span><span class="n">BiocFrame</span><span class="p">({</span>
    <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span> <span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Saving to one location:</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">dolomite_base</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;my_df&quot;</span><span class="p">)</span>
<span class="n">dolomite_base</span><span class="o">.</span><span class="n">save_object</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="c1"># Reading from another location:</span>
<span class="n">alt_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">alt_path</span><span class="p">)</span>
<span class="n">alt_out</span> <span class="o">=</span> <span class="n">dolomite_base</span><span class="o">.</span><span class="n">read_object</span><span class="p">(</span><span class="n">alt_path</span><span class="p">)</span>
</pre></div>
</div>
<p>That said, it is unwise to manipulate the files inside the directory created by <code class="docutils literal notranslate"><span class="pre">save_object()</span></code>.
Reading functions will usually depend on specific file names or subdirectory structures within the directory, and fiddling with them may cause unexpected results.
Advanced users can exploit this by loading components from subdirectories if the full object is not required:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating a nested DF:</span>
<span class="n">nested</span> <span class="o">=</span> <span class="n">biocframe</span><span class="o">.</span><span class="n">BiocFrame</span><span class="p">({</span> <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="n">df</span> <span class="p">})</span>
<span class="n">nest_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;nesting&quot;</span><span class="p">)</span>
<span class="n">dolomite_base</span><span class="o">.</span><span class="n">save_object</span><span class="p">(</span><span class="n">nested</span><span class="p">,</span> <span class="n">nest_path</span><span class="p">)</span>

<span class="c1"># Now reading in the nested DF:</span>
<span class="n">redf</span> <span class="o">=</span> <span class="n">dolomite_base</span><span class="o">.</span><span class="n">read_object</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nest_path</span><span class="p">,</span> <span class="s2">&quot;other_columns&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="validating-files">
<h2>Validating files<a class="headerlink" href="#validating-files" title="Link to this heading">¶</a></h2>
<p>Each Bioconductor class’s on-disk representation is determined by the associated <a class="reference external" href="https://github.com/ArtifactDB/takane"><strong>takane</strong> specification</a>.
For example, <code class="docutils literal notranslate"><span class="pre">save_object()</span></code> will save a <code class="docutils literal notranslate"><span class="pre">BiocFrame</span></code> according to the <a class="reference external" href="https://github.com/ArtifactDB/takane/blob/gh-pages/docs/specifications/data_frame/1.0.md"><code class="docutils literal notranslate"><span class="pre">data_frame</span></code> specification</a>.
More complex objects may be represented by multiple files, possibly including subdirectories with “child” objects.</p>
<p>Each call to <code class="docutils literal notranslate"><span class="pre">save_object()</span></code> will automatically enforce the relevant specification by validating the directory contents with <strong>dolomite-base</strong>’s <code class="docutils literal notranslate"><span class="pre">validate_object()</span></code> function.
Successful validation provides some guarantees on the file structure within the directory, allowing developers to reliably implement readers in other frameworks.
Conversely, the <a class="reference external" href="https://github.com/ArtifactDB/alabaster.base"><strong>alabaster</strong></a> suite applies the same validators on directories generated within an R session,
which ensures that <strong>dolomite-base</strong> is able to read those objects into a Python environment.</p>
<p>Users can also call <code class="docutils literal notranslate"><span class="pre">validate_object()</span></code> themselves, if they have modified the directory after calling <code class="docutils literal notranslate"><span class="pre">save_object()</span></code> and they want to check that the contents are still valid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mocking up an object:</span>
<span class="kn">import</span> <span class="nn">biocframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">biocframe</span><span class="o">.</span><span class="n">BiocFrame</span><span class="p">({</span>
    <span class="s2">&quot;X&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)),</span>
    <span class="s2">&quot;Y&quot;</span><span class="p">:</span> <span class="p">[</span> <span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="s2">&quot;j&quot;</span> <span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Saving to one location:</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">dolomite_base</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;my_df&quot;</span><span class="p">)</span>
<span class="n">dolomite_base</span><span class="o">.</span><span class="n">save_object</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="c1"># So far so good...</span>
<span class="n">dolomite_base</span><span class="o">.</span><span class="n">validate_object</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="c1"># Deleting the file to make it invalid:</span>
<span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;basic_columns.h5&quot;</span><span class="p">))</span>
<span class="n">dolomite_base</span><span class="o">.</span><span class="n">validate_object</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="c1">## Traceback (most recent call last):</span>
<span class="c1">## etc...</span>
</pre></div>
</div>
</section>
<section id="extending-to-new-classes">
<h2>Extending to new classes<a class="headerlink" href="#extending-to-new-classes" title="Link to this heading">¶</a></h2>
<p>The <strong>dolomite</strong> framework is easily extended to new classes by:</p>
<ol class="arabic simple">
<li><p>Writing a method for <code class="docutils literal notranslate"><span class="pre">save_object()</span></code>.
This should accept an instance of the object and a path to a directory, and save the contents of the object inside the directory.
It should also produce an <code class="docutils literal notranslate"><span class="pre">OBJECT</span></code> file that specifies the type of the object, e.g., <code class="docutils literal notranslate"><span class="pre">data_frame</span></code>, <code class="docutils literal notranslate"><span class="pre">hdf5_sparse_matrix</span></code>.</p></li>
<li><p>Writing a function for <code class="docutils literal notranslate"><span class="pre">read_object()</span></code> and registering it in the <code class="docutils literal notranslate"><span class="pre">read_object_registry</span></code>.
This should accept a path to a directory and read its contents to reconstruct the object.
The registered type should be the same as that used in the <code class="docutils literal notranslate"><span class="pre">OBJECT</span></code> file.</p></li>
<li><p>Writing a function for <code class="docutils literal notranslate"><span class="pre">validate_object()</span></code> and registering it in the <code class="docutils literal notranslate"><span class="pre">validate_object_registry</span></code>.
This should accept a path to a directory and read its contents to determine if it is a valid on-disk representation.
The registered type should be the same as that used in the <code class="docutils literal notranslate"><span class="pre">OBJECT</span></code> file.</p>
<ul class="simple">
<li><p>(optional) Devleopers can alternatively formalize the on-disk representation by adding a specification to the <a class="reference external" href="https://github.com/ArtifactDB/takane"><strong>takane</strong></a> repository.
This aims to provide C+±based validators for each representation, allowing us to enforce consistency across multiple languages (e.g., R).
Any <strong>takane</strong> validator is automatically used by <code class="docutils literal notranslate"><span class="pre">validate_object()</span></code> so no registration is required.</p></li>
</ul>
</li>
</ol>
<p>To illustrate, let’s extend <strong>dolomite</strong> to a new custom class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Coffee</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beans</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">milk</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beans</span> <span class="o">=</span> <span class="n">beans</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">milk</span> <span class="o">=</span> <span class="n">milk</span>
</pre></div>
</div>
<p>First we implement the saving method.
Note that we add a <code class="docutils literal notranslate"><span class="pre">&#64;validate_saves</span></code> decorator to instruct <code class="docutils literal notranslate"><span class="pre">save_object()</span></code> to automatically run <code class="docutils literal notranslate"><span class="pre">validate_object()</span></code> on the directory by the <code class="docutils literal notranslate"><span class="pre">Coffee</span></code> method.
This confirms that the output is valid according to our (yet to be added) validator method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">dolomite_base</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="nd">@dolomite_base</span><span class="o">.</span><span class="n">save_object</span><span class="o">.</span><span class="n">register</span>
<span class="nd">@dolomite_base</span><span class="o">.</span><span class="n">validate_saves</span>
<span class="k">def</span> <span class="nf">save_object_for_Coffee</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Coffee</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;bean_type&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">beans</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;has_milk&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">handle</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">milk</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;OBJECT&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;coffee&quot;</span><span class="p">,</span> <span class="s2">&quot;coffee&quot;</span><span class="p">:</span> <span class="p">{</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1&quot;</span> <span class="p">}</span> <span class="p">},</span> <span class="n">handle</span><span class="p">)</span>
</pre></div>
</div>
<p>Then we implement and register the reading method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span>

<span class="k">def</span> <span class="nf">read_Coffee</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Coffee</span><span class="p">:</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;coffee&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="c1"># possibly do something different based on version</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;bean_type&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">beans</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;has_milk&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">milk</span> <span class="o">=</span> <span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Coffee</span><span class="p">(</span><span class="n">beans</span><span class="p">,</span> <span class="n">milk</span><span class="p">)</span>

<span class="n">dolomite_base</span><span class="o">.</span><span class="n">read_object_registry</span><span class="p">[</span><span class="s2">&quot;coffee&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">read_Coffee</span>
</pre></div>
</div>
<p>And finally, the validation method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">validate_Coffee</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
    <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;coffee&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="c1"># possibly do something different based on version</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;bean_type&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">beans</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">beans</span> <span class="ow">in</span> <span class="p">[</span> <span class="s2">&quot;arabica&quot;</span><span class="p">,</span> <span class="s2">&quot;robusta&quot;</span><span class="p">,</span> <span class="s2">&quot;excelsa&quot;</span><span class="p">,</span> <span class="s2">&quot;liberica&quot;</span> <span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wrong bean type &#39;&quot;</span> <span class="o">+</span> <span class="n">beans</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;has_milk&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">milk</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">milk</span> <span class="ow">in</span> <span class="p">[</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;false&quot;</span> <span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid milk &#39;&quot;</span> <span class="o">+</span> <span class="n">milk</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

<span class="n">dolomite_base</span><span class="o">.</span><span class="n">validate_object_registry</span><span class="p">[</span><span class="s2">&quot;coffee&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">validate_Coffee</span>
</pre></div>
</div>
<p>Let’s run them and see how it works:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cup</span> <span class="o">=</span> <span class="n">Coffee</span><span class="p">(</span><span class="s2">&quot;arabica&quot;</span><span class="p">,</span> <span class="n">milk</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;stuff&quot;</span><span class="p">)</span>
<span class="n">dolomite_base</span><span class="o">.</span><span class="n">save_object</span><span class="p">(</span><span class="n">cup</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="n">cup2</span> <span class="o">=</span> <span class="n">dolomite_base</span><span class="o">.</span><span class="n">read_object</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cup2</span><span class="o">.</span><span class="n">beans</span><span class="p">)</span>
<span class="c1">## arabica</span>
</pre></div>
</div>
<p>For more complex objects that are composed of multiple smaller “child” objects, developers should consider saving each of their children in subdirectories of <code class="docutils literal notranslate"><span class="pre">path</span></code>.
This can be achieved by calling <code class="docutils literal notranslate"><span class="pre">alt_save_object()</span></code> and <code class="docutils literal notranslate"><span class="pre">alt_read_object()</span></code> in the saving and loading functions, respectively.
(We use the <code class="docutils literal notranslate"><span class="pre">alt_*</span></code> versions of these functions to respect application overrides, see below.)</p>
</section>
<section id="creating-applications">
<h2>Creating applications<a class="headerlink" href="#creating-applications" title="Link to this heading">¶</a></h2>
<p>Developers can also create applications that customize the machinery of the <em>dolomite</em> framework for specific needs.
In most cases, this involves storing more metadata to describe the object in more detail.
For example, we might want to remember the identity of the author for each object.
This is achieved by creating an application-specific saving generic with the same signature as <code class="docutils literal notranslate"><span class="pre">save_object()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">singledispatch</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="nn">dolomite_base</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">biocframe</span>

<span class="k">def</span> <span class="nf">dump_extra_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">extra</span><span class="p">:</span> <span class="n">Dict</span><span class="p">):</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getuser</span><span class="p">()</span>
    <span class="c1"># File names with leading underscores are reserved for application-specific</span>
    <span class="c1"># use, so they won&#39;t clash with anything produced by save_object().</span>
    <span class="n">metapath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;_metadata.json&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">metapath</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">({</span> <span class="o">**</span><span class="n">extra</span><span class="p">,</span> <span class="s2">&quot;author&quot;</span><span class="p">:</span> <span class="n">user_id</span> <span class="p">},</span> <span class="n">handle</span><span class="p">)</span>

<span class="nd">@singledispatch</span>
<span class="k">def</span> <span class="nf">app_save_object</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">dolomite_base</span><span class="o">.</span><span class="n">save_object</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1"># does the real work</span>
    <span class="n">dump_extra_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">{})</span> <span class="c1"># adding some application-specific metadata</span>

<span class="nd">@app_save_object</span><span class="o">.</span><span class="n">register</span>
<span class="k">def</span> <span class="nf">app_save_object_for_BiocFrame</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">biocframe</span><span class="o">.</span><span class="n">BiocFrame</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">dolomite_base</span><span class="o">.</span><span class="n">save_object</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="c1"># does the real work</span>
    <span class="c1"># We can also override specific methods to add object+application-specific metadata:</span>
    <span class="n">dump_extra_metadata</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;columns&quot;</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get_column_names</span><span class="p">()</span><span class="o">.</span><span class="n">as_list</span><span class="p">()</span> <span class="p">})</span>
</pre></div>
</div>
<p>In general, applications should avoid modifying the files created by the <code class="docutils literal notranslate"><span class="pre">dolomite_base.save_object()</span></code> call, to avoid violating any <strong>takane</strong> format specifications
(unless the application maintainer really knows what they’re doing).
Applications are free to write to any path starting with an underscore as this will not be used by any specification.</p>
<p>Once a generic is defined, applications should call <code class="docutils literal notranslate"><span class="pre">alt_save_object_function()</span></code> to instruct <code class="docutils literal notranslate"><span class="pre">alt_save_object()</span></code> to use it instead of <code class="docutils literal notranslate"><span class="pre">dolomite_base.save_object()</span></code>.
This ensures that the customizations are applied to all child objects, such as the nested <code class="docutils literal notranslate"><span class="pre">BiocFrame</span></code> below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a friendly user-visible function to perform the generic override; this</span>
<span class="c1"># is reversed on function exit to avoid interfering with other applications.</span>
<span class="k">def</span> <span class="nf">save_for_application</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="n">dolomite_base</span><span class="o">.</span><span class="n">alt_save_object_function</span><span class="p">(</span><span class="n">app_save_object</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dolomite_base</span><span class="o">.</span><span class="n">alt_save_object</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">dolomite_base</span><span class="o">.</span><span class="n">alt_save_object_function</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>

<span class="c1"># Saving our nested BiocFrames with our overrides active.</span>
<span class="kn">import</span> <span class="nn">biocframe</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">biocframe</span><span class="o">.</span><span class="n">BiocFrame</span><span class="p">({</span>
    <span class="s2">&quot;A&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="s2">&quot;B&quot;</span><span class="p">:</span> <span class="n">biocframe</span><span class="o">.</span><span class="n">BiocFrame</span><span class="p">({</span>
        <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">]</span>
    <span class="p">})</span>
<span class="p">})</span>

<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="n">tmp</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="s2">&quot;foobar&quot;</span><span class="p">)</span>
<span class="n">save_for_application</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="c1"># Both the parent and child BiocFrames have new metadata.</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;_metadata.json&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c1">## {&quot;columns&quot;: [&quot;A&quot;, &quot;B&quot;], &quot;author&quot;: &quot;aaron&quot;}</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;other_columns&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;_metadata.json&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="c1">## {&quot;columns&quot;: [&quot;C&quot;], &quot;author&quot;: &quot;aaron&quot;}</span>
</pre></div>
</div>
<p>The reading function can be similarly overridden by setting <code class="docutils literal notranslate"><span class="pre">alt_read_object_function()</span></code> to instruct all <code class="docutils literal notranslate"><span class="pre">alt_read_object()</span></code> calls to use the override.
This allows applications to, e.g., do something with the metadata that we just added.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">app_read_object</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;OBJECT&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
            <span class="n">metadata</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="c1"># Print custom message based on the type and application-specific metadata.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;_metadata.json&quot;</span><span class="p">),</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">appmeta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am a &quot;</span> <span class="o">+</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; created by &quot;</span> <span class="o">+</span> <span class="n">appmeta</span><span class="p">[</span><span class="s2">&quot;author&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;data_frame&quot;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I have the following columns: &quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">appmeta</span><span class="p">[</span><span class="s2">&quot;columns&quot;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">dolomite_base</span><span class="o">.</span><span class="n">read_object</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># Creating a user-friendly function to set the override before the read operation.</span>
<span class="k">def</span> <span class="nf">read_for_application</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">old</span> <span class="o">=</span> <span class="n">dolomite_base</span><span class="o">.</span><span class="n">alt_read_object_function</span><span class="p">(</span><span class="n">app_read_object</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">dolomite_base</span><span class="o">.</span><span class="n">alt_read_object</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">dolomite_base</span><span class="o">.</span><span class="n">alt_read_object_function</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>

<span class="c1"># This diverts to the override with printing of custom messages.</span>
<span class="n">read_for_application</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="c1">## I am a data_frame created by aaron</span>
<span class="c1">## I have the following columns: A, B</span>
<span class="c1">## I am a data_frame created by aaron</span>
<span class="c1">## I have the following columns: C</span>
</pre></div>
</div>
<p>By overriding the saving and reading process for one or more classes, each application can customize the behavior of the <strong>dolomite</strong> framework to their own needs.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="contributing.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Contributing</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Home</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Aaron Lun
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Save and load Bioconductor objects in Python</a><ul>
<li><a class="reference internal" href="#quick-start">Quick start</a></li>
<li><a class="reference internal" href="#supported-classes">Supported classes</a></li>
<li><a class="reference internal" href="#operating-on-directories">Operating on directories</a></li>
<li><a class="reference internal" href="#validating-files">Validating files</a></li>
<li><a class="reference internal" href="#extending-to-new-classes">Extending to new classes</a></li>
<li><a class="reference internal" href="#creating-applications">Creating applications</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=e259d695"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>